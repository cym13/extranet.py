#!/usr/bin/env python
import sys, os, getpass
from icalendar import Calendar, Event
sys.path.append(os.path.abspath('..'))
from extranet import Extranet

def ext_to_ical(event):
    ev = Event()
    ev.add('summary', event['title'])
    ev.add('dtstart', event['start'])
    ev.add('dtend', event['end'])
    ev.add('location', event['room'])
    ev.add('organizer', event['teacher'])
    return ev

def main(username, password):
    ext = Extranet(username, password)
    cal = Calendar()
    cal.add('prodid', '-//Extranet.py//ork//')
    cal.add('version', '0.1')

    for event in map(ext_to_ical, ext.timetable):
        cal.add_component(event)

    with open('extranet.ics', 'wb') as f:
        f.write(cal.to_ical())

if __name__ == '__main__':
    username = input('Username: ')
    password = getpass.getpass('Password: ')
    main(username, password)
